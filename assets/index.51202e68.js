var N=Object.defineProperty,A=Object.defineProperties;var O=Object.getOwnPropertyDescriptors;var P=Object.getOwnPropertySymbols;var B=Object.prototype.hasOwnProperty,R=Object.prototype.propertyIsEnumerable;var v=(r,e,t)=>e in r?N(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,I=(r,e)=>{for(var t in e||(e={}))B.call(e,t)&&v(r,t,e[t]);if(P)for(var t of P(e))R.call(e,t)&&v(r,t,e[t]);return r},E=(r,e)=>A(r,O(e));var a=(r,e,t)=>(v(r,typeof e!="symbol"?e+"":e,t),t);import{r as i,j as s,P as k,t as _,u as M,a as h,D as j,b as L,T as W,c as $,B as g,d as U,e as T,f as q,g as G,v as K,G as l,h as C,C as z,i as H,k as V,l as J,m as Q,n as X,R as Y,o as Z,p as ee,q as te,s as re}from"./vendor.5429f9b2.js";const ne=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))c(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const u of o.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&c(u)}).observe(document,{childList:!0,subtree:!0});function t(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerpolicy&&(o.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?o.credentials="include":n.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function c(n){if(n.ep)return;n.ep=!0;const o=t(n);fetch(n.href,o)}};ne();const se={};class oe{constructor(){a(this,"peer");a(this,"conn",null);a(this,"id",null);a(this,"callbacks",[]);a(this,"status","initial");a(this,"subscribe",e=>{const t=this.callbacks;return t.push(e),()=>{t.splice(t.indexOf(e),1)}});a(this,"unsubcribe",e=>{const t=this.callbacks;t.splice(t.indexOf(e),t.includes(e)?1:0)});a(this,"notify",()=>{this.callbacks.forEach(e=>e())});a(this,"onRing",e=>{this.status!=="disconnected"&&e.close(),this.conn=e,this.status="ring",this.notify()});a(this,"call",async e=>{try{if(this.status!=="disconnected"||!!this.conn)throw new Error("Illegal status for call");this.status="calling",this.notify();const t=await navigator.mediaDevices.getUserMedia({audio:!0,video:!0}),c=this.peer.call(e,t);return await this.getConnStream(c)}catch(t){throw t}});a(this,"answer",async()=>{try{if(this.status!=="ring"||!this.conn)throw new Error("Illegal status for answer");const e=this.conn,t=await navigator.mediaDevices.getUserMedia({audio:!0,video:!0});return e.answer(t),await this.getConnStream(e)}catch(e){throw e}});a(this,"disconnect",()=>{if(this.status!=="connected"&&this.status!=="ring"||!this.conn)throw new Error("Illegal status to disconnect");this.conn.close()});a(this,"getConnStream",async e=>{try{const t=await new Promise((c,n)=>{const o=()=>{d(),this.conn=null,this.status="disconnected",this.notify()},u=m=>{d(),n(m)},p=m=>{d(),this.conn=e,this.status="connected",this.notify(),c(m)},d=()=>{e.off("close",o),e.off("error",u),e.off("stream",p)};e.on("close",o),e.on("error",u),e.on("stream",p)});return e.on("close",this.onStreamClose),t}catch(t){throw t}});a(this,"onStreamClose",()=>{var e;(e=this.conn)==null||e.off("close",this.onStreamClose),this.conn=null,this.status="disconnected",this.notify()});const e=new k(se),t=()=>{e.off("open",t),e.off("error",c),this.id=e.id,this.status="disconnected",this.notify()},c=n=>{e.off("open",t),e.off("error",c),this.status="error",this.notify()};e.on("open",t),e.on("error",c),e.on("call",this.onRing),this.peer=e}}const S=i.exports.createContext(null),b=()=>{const r=i.exports.useContext(S);if(!r)throw new Error("No PeerContext provided.");return r},D=()=>{const[,r]=i.exports.useReducer(()=>[],[]),e=b();return i.exports.useEffect(()=>e.subscribe(r)),e.status},ce=({children:r})=>{const[e]=i.exports.useState(()=>new oe);return s(S.Provider,{value:e,children:r})},{makeStyles:w}=_.createMakeStyles({useTheme:M}),y=r=>r,ie={error:{icon:U,iconStyle:y("errorIcon")},warning:{icon:T,iconStyle:y("warningIcon")},info:{icon:q,iconStyle:y("infoIcon")},success:{icon:G,iconStyle:y("successIcon")}},ae=w()(r=>({root:{},content:{padding:"1.5rem 1.5rem 0rem 1.5rem",minHeight:"6rem",display:"flex",alignItems:"center"},actions:{padding:"0.5rem 1.5rem 1rem 1.5rem",justifyContent:"center","& > .MuiButton-root":{minWidth:"8rem"}},icon:{flex:"0 0 auto",width:"3rem",height:"3rem"},message:{flex:"1 1",fontSize:"1rem",paddingLeft:"1.5rem",whiteSpace:"pre-wrap"},errorIcon:{color:r.palette.error.main},warningIcon:{color:r.palette.warning.main},infoIcon:{color:r.palette.info.main},successIcon:{color:r.palette.success.main}})),le=({iconType:r,message:e,onClose:t,okButtonText:c})=>{const{classes:n,cx:o}=ae(),{icon:u,iconStyle:p}=ie[r!=null?r:"info"];return h(j,{className:o("MessageDialog",n.root),open:!0,maxWidth:"sm",fullWidth:!0,onClose:void 0,children:[h(L,{className:n.content,children:[s(u,{className:o(n.icon,n[p])}),s(W,{className:o(n.message),children:e})]}),s($,{className:n.actions,children:s(g,{ref:d=>d==null?void 0:d.focus(),variant:"outlined",onClick:t,children:c!=null?c:"OK"})})]})},ue={message:le},de=i.exports.createContext(null),he=(r,e,t)=>c=>new Promise((n,o)=>{const u=s(r,E(I({},c),{onClose:(...p)=>{const d=e.indexOf(u);d>=0?(e.splice(d,1),t(),n(p)):o("Illegal dialog close.")},onError:o}),K());e.push(u),t()}),me=({children:r})=>{const e=i.exports.useRef([]).current,[,t]=i.exports.useReducer(()=>[],[]),[c]=i.exports.useState(()=>Object.entries(ue).reduce((n,[o,u])=>(n[o]=he(u,e,t),n),{}));return h(de.Provider,{value:c,children:[r,e.map(n=>n)]})};class pe extends i.exports.Component{constructor(){super(...arguments);a(this,"state",{hasError:!1})}static getDerivedStateFromError(e){return{hasError:!0}}componentDidCatch(e,t){console.error("Uncaught error:",e,t)}render(){const{children:e}=this.props;return this.state.hasError?s("h1",{children:"\u30A8\u30E9\u30FC\u306E\u767A\u751F\u306F\u60F3\u5B9A\u3055\u308C\u3066\u3044\u307E\u305B\u3093\uFF01"}):e}}const fe=w()(r=>({root:{marginTop:"0.5em",marginBottom:"0.5em",fontWeight:"bold"},paper:{padding:"0.2em 0.5em 0.0em 0.5em",border:"2px solid",borderColor:"gray"},button:{}})),ge=()=>{var n;const{classes:r,cx:e}=fe(),t=b();D();const c=i.exports.useCallback(()=>{t.id&&navigator.clipboard.writeText(t.id)},[]);return h(l,{container:!0,className:e("IdPanel",r.root),alignItems:"center",spacing:1,children:[s(l,{item:!0,children:s(C,{className:r.paper,children:"Peer Id"})}),s(l,{item:!0,children:(n=t.id)!=null?n:"Peer\u30B5\u30FC\u30D0\u30FC\u306B\u63A5\u7D9A\u4E2D\u30FB\u30FB\u30FB"}),s(l,{item:!0,children:s(g,{variant:"contained",className:r.button,onClick:c,children:"\u30B3\u30D4\u30FC"})})]})},Ce=w()(r=>({headPaper:{padding:"0.2em 0.5em 0.0em 0.5em",border:"2px solid",borderColor:"gray",fontWeight:"bold"},messagePaper:{padding:"0.2em 0.5em 0.0em 0.5em",border:"2px solid",borderColor:"gray"},idInput:{width:"20rem"},card:{marginTop:"1rem",width:"30rem",height:"30rem",border:"solid 4px grey"},video:{width:"100%",height:"100%"}}));function ye(){const{classes:r,cx:e}=Ce(),t=b(),c=D(),n=i.exports.useRef(null),o=i.exports.useRef(null);i.exports.useEffect(()=>t.subscribe(()=>{var m;t.status!=="connected"&&((m=n.current)==null?void 0:m.srcObject)&&(n.current.srcObject=null)}));const u=i.exports.useCallback(async m=>{var f;try{if(!((f=o.current)==null?void 0:f.value)||!n.current)return;const x=o.current.value,F=await t.call(x);n.current.srcObject=F}catch(x){console.log("Call error.",x)}},[]),p=i.exports.useCallback(async m=>{try{if(!n.current)return;const f=await t.answer();n.current.srcObject=f}catch(f){console.log("Answer error.",f)}},[]),d=i.exports.useCallback(async m=>{t.disconnect()},[]);return h(z,{className:"root",children:[s(ge,{}),c==="disconnected"?h(l,{container:!0,alignItems:"center",spacing:1,children:[s(l,{item:!0,children:s(C,{className:r.headPaper,children:"\u63A5\u7D9A\u5148"})}),s(l,{item:!0,children:s(H,{className:r.idInput,inputRef:o})}),s(l,{item:!0,children:s(g,{variant:"contained",color:"primary",onClick:u,children:"\u547C\u51FA"})})]}):c==="calling"?s(l,{container:!0,alignItems:"center",spacing:1,children:s(l,{item:!0,children:s(C,{className:r.messagePaper,children:"\u547C\u3073\u51FA\u3057\u3066\u3044\u307E\u3059..."})})}):c==="ring"?h(l,{container:!0,alignItems:"center",spacing:1,children:[s(l,{item:!0,children:s(C,{className:r.messagePaper,children:"\u547C\u51FA\u3092\u53D7\u3051\u3066\u3044\u307E\u3059\u30FB\u30FB\u30FB"})}),s(l,{item:!0,children:s(g,{variant:"contained",color:"primary",onClick:p,children:"\u5FDC\u7B54"})})]}):c==="connected"?h(l,{container:!0,alignItems:"center",spacing:1,children:[s(l,{item:!0,children:s(C,{className:r.messagePaper,children:"\u901A\u8A71\u4E2D"})}),s(l,{item:!0,children:s(g,{variant:"contained",color:"secondary",onClick:d,children:"\u5207\u65AD"})})]}):null,s(V,{className:r.card,children:s(J,{component:"video",className:r.video,ref:n,autoPlay:!0})})]})}var xe=Q({});const ve=X({key:"mui",prepend:!0});Y.render(h(Z.StrictMode,{children:[h(ee,{value:ve,children:[s(te,{}),s(re,{theme:xe,children:s(me,{children:s(pe,{children:s(ce,{children:s(ye,{})})})})})]}),","]}),document.getElementById("root"));
